humhub.module("calendar.participation.Form",function(r,t,s){var a=t("ui.widget").Widget,o=t("ui.loader"),c=t("client"),e=t("ui.status"),i=t("calendar"),n=t("ui.modal"),d=a.extend();d.prototype.init=function(){var a=this;this.saveButton=s("#calendar-entry-participation-button-save"),this.nextButton=s("#calendar-entry-participation-button-next"),this.backButton=s("#calendar-entry-participation-button-back"),this.tabSettings=s("#calendar-entry-participation-tabs li.tab-participation"),this.tabParticipants=s("#calendar-entry-participation-tabs li.tab-participants"),this.isNewRecord=this.backButton.length,this.isNewRecord&&s("#calendar-entry-participation-tabs li a").click(function(){if(1<s("#calendar-entry-participation-tabs li:visible").length){var t=0===s(this).closest("li").index();a.saveButton.toggleClass("d-none",t),a.nextButton.toggleClass("d-none",!t)}})},d.prototype.changeParticipantsListPage=function(t){var i=this;t.preventDefault(),n.footerLoader(),c.get(t).then(function(t){var a=s(t.html).filter("#calendar-entry-participants-list");i.$.find("#calendar-entry-participants-list").replaceWith(a)}).catch(function(t){r.log.error(t,!0)}).finally(function(){o.reset(n.global.getFooter()),t.finish()})},d.prototype.update=function(t){var a=t.$trigger.parent(),i=t.$trigger.parent().html(),n={entryId:this.data("entry-id"),userId:t.$trigger.closest("[data-user-id]").data("user-id"),status:t.$trigger.val()};o.set(a,{size:"10px",css:{padding:"0px"}}),c.post(this.data("update-url"),{data:n}).then(function(t){t.success&&(e.success(t.message),o.remove(a),a.html(i).find("select").val(n.status))}).catch(function(t){r.log.error(t,!0)}).finally(function(){t.finish()})},d.prototype.remove=function(t){var a=t.$trigger.closest("[data-user-id]"),i={entryId:this.data("entry-id"),userId:a.data("user-id")};c.post(this.data("remove-url"),{data:i}).then(function(t){t.success?(e.success(t.message),1===a.closest(".hh-list").find("[data-user-id]").length&&a.closest(".hh-list").prev("p").show(),a.remove(),l(-1)):e.error(t.message)}).catch(function(t){r.log.error(t,!0)}).finally(function(){t.finish()})},d.prototype.add=function(t){var n=t.$trigger.closest(".calendar-entry-new-participants-form"),a={entryId:this.data("entry-id"),guids:n.find('select[name="CalendarEntryParticipationForm[newParticipants][]"]').val()},i=n.find('select[name="CalendarEntryParticipationForm[newParticipantStatus]"]');i.length&&(a.status=i.val()),c.post(t,{data:a}).then(function(t){if(t.html){var a=n.closest(".calendar-entry-participants").find("#calendar-entry-participants-list .hh-list"),i=a.find("> div").length;a.append(t.html),l(a.find("> div").length-i)}t.success?e.success(t.success):t.warning?e.warn(t.warning):t.error&&e.error(t.error)}).catch(function(t){r.log.error(t,!0)}).finally(function(){t.finish()})},d.prototype.filterState=function(t){var a=t.$trigger,i=a.parent(),n=s("#globalModal"),e={id:this.data("entry-id"),state:a.data("state")};a.attr("data-active",""),o.set(i,{size:"10px",css:{padding:"0px"}}),c.get(this.data("filter-url"),{data:e}).then(function(t){n.find("#calendar-entry-participants-list").after(t.html).remove(),l(n.find("[name=calendar-entry-participants-count]").val(),!1),o.reset(i),i.find(".btn.active").removeClass("active"),i.find("[data-active]").addClass("active").removeAttr("data-active")}).catch(function(t){r.log.error(t,!0)}).finally(function(){t.finish()})},d.prototype.changeParticipationMode=function(t){var a=0==t.$trigger.val();a?this.$.find(".participationOnly").fadeOut("fast"):this.$.find(".participationOnly").fadeIn("fast"),this.tabParticipants.toggleClass("d-none",a),this.isNewRecord&&(this.saveButton.toggleClass("d-none",!a),this.nextButton.toggleClass("d-none",a))};var l=function(t,a){var i=s("#globalModal").find(".calendar-entry-participants-count span");i.html(a||void 0===a?parseInt(i.html())+t:t)};d.prototype.next=function(t){this.tabParticipants.find("a").tab("show"),this.nextButton.addClass("d-none"),this.saveButton.removeClass("d-none"),t.finish()},d.prototype.back=function(t){this.tabParticipants.find("a").hasClass("active")?(this.tabSettings.find("a").tab("show"),this.saveButton.addClass("d-none"),this.nextButton.removeClass("d-none")):(o.set(t.$trigger,{size:"10px",css:{padding:"0px"}}),i.editModal(t)),t.finish()},r.export=d});